# Firestore Data Structure

This document outlines the collections and data structures used in the Firestore database for the Odoo-style Expense Management System.

## Collections

-   `companies`
-   `users`
-   `expenses`
-   `approval_flows`
-   `approval_steps`
-   `expense_approvals`

---

### `companies`

Stores information about each company registered in the system.

**Document ID:** Auto-generated by Firestore

| Field            | Type   | Description                               |
| ---------------- | ------ | ----------------------------------------- |
| `name`           | String | The name of the company.                  |
| `default_currency` | String | The default currency for the company (e.g., "USD"). |

---

### `users`

Stores user accounts and their associated roles and relationships.

**Document ID:** Firebase Auth User UID

| Field         | Type   | Description                                       |
| ------------- | ------ | ------------------------------------------------- |
| `name`        | String | The user's full name.                             |
| `email`       | String | The user's email address.                         |
| `role`        | String | The user's role (`Admin`, `Manager`, `Employee`). |
| `company_id`  | String | A reference to the `companies` document ID.       |
| `manager_id`  | String | A reference to another `users` document ID (the user's manager). |

---

### `expenses`

Stores individual expense claims submitted by employees.

**Document ID:** Auto-generated by Firestore

| Field          | Type      | Description                                                     |
| -------------- | --------- | --------------------------------------------------------------- |
| `employee_id`  | String    | A reference to the `users` document ID of the submitting employee. |
| `amount`       | Number    | The monetary value of the expense.                              |
| `currency`     | String    | The currency of the expense (e.g., "EUR").                      |
| `category`     | String    | The category of the expense (e.g., "Travel", "Food").           |
| `description`  | String    | A detailed description of the expense.                          |
| `expense_date` | Timestamp | The date the expense was incurred.                              |
| `status`       | String    | The current status (`Pending`, `Approved`, `Rejected`).         |
| `flow_id`      | String    | A reference to the `approval_flows` document ID.                |
| `created_at`   | Timestamp | The timestamp when the expense was submitted.                   |
| `receipt_url`  | String    | (Optional) URL to the uploaded receipt image.                   |

---

### `approval_flows`

Defines the custom approval workflows created by Admins.

**Document ID:** Auto-generated by Firestore

| Field                       | Type    | Description                                                     |
| --------------------------- | ------- | --------------------------------------------------------------- |
| `name`                      | String  | The name of the approval flow.                                  |
| `company_id`                | String  | A reference to the `companies` document ID.                     |
| `is_manager_approver_first` | Boolean | If `true`, the employee's manager must approve first.             |
| `rule_type`                 | String  | (Optional) `Percentage`, `SpecificApprover`, or `Hybrid`.       |
| `approval_percentage`       | Number  | (Optional) The percentage required for the `Percentage` rule.   |
| `critical_approver_id`      | String  | (Optional) The `users` ID for the `SpecificApprover` rule.      |

---

### `approval_steps`

Defines the individual steps and sequence within an `approval_flow`.

**Document ID:** Auto-generated by Firestore

| Field            | Type   | Description                                          |
| ---------------- | ------ | ---------------------------------------------------- |
| `flow_id`        | String | A reference to the `approval_flows` document ID.     |
| `approver_id`    | String | A reference to the `users` document ID of the approver. |
| `sequence_order` | Number | The order of this step in the flow (e.g., 1, 2, 3).  |

---

### `expense_approvals`

Tracks the approval status for each approver on a specific expense. A new document is created for each step in the workflow for a given expense.

**Document ID:** Auto-generated by Firestore

| Field         | Type      | Description                                                     |
| ------------- | --------- | --------------------------------------------------------------- |
| `expense_id`  | String    | A reference to the `expenses` document ID.                      |
| `approver_id` | String    | A reference to the `users` document ID of the current approver. |
| `status`      | String    | The status for this step (`Pending`, `Approved`, `Rejected`).   |
| `comments`    | String    | (Optional) Comments from the approver.                          |
| `updated_at`  | Timestamp | The timestamp when the approver took action.                    |
